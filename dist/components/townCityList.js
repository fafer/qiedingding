"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_util=require("./../utils/util.js"),TownCityList=function(t){function e(){var t,i,n,a;_classCallCheck(this,e);for(var s=arguments.length,o=Array(s),r=0;r<s;r++)o[r]=arguments[r];return i=n=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),n.data={position:"",citys:[{defaultName:"选择省",name:"",value:"",index:0},{defaultName:"选择市",name:"",value:"",index:0},{defaultName:"选择区/县",name:"",value:"",index:0},{defaultName:"选择乡镇",name:"",value:"",index:0}],level:0,toView:"",hideList:!0,searchs:[]},n.computed={currentCitys:function(){return e.list[this.level]},currentValue:function(){return this.citys[this.level].value}},n.methods={change:function(t,i){if(i!==this.level){var n=e.list[i];if(n.length){this.level=i,this.hideList=!1;var a=t.index;this.toView=a>1?"town-list-"+n[a-2].id:"town-list-"+n[0].id}}},select:function(t,e){var i=this.citys[this.level];if(i.name=t.name.length>5?t.name.substring(0,2)+"..."+t.name.substring(t.name.length-2):t.name,i.value=t.id,i.index=e,this.hideList=!0,3===this.level)(0,_util.openTownApp)("pages/index/index?localId="+this.citys[3].value);else{var n=this.level+1;1===n?this.getCityData(t.id,n):this.updateCityData(n,t.list)}},initPosition:function(t){this.position=t},search:function(t){var i=this;if(""===t)return void(this.searchs=[]);e.searchTimeoutId&&clearTimeout(e.searchTimeoutId),e.searchTimeoutId=setTimeout(function(){var n=[];e.towlist.forEach(function(e){-1===e.desc.indexOf(t)&&-1===e.name.indexOf(t)&&-1===e.pinyin.indexOf(t)&&-1===e.shortName.indexOf(t)||n.push(e)}),i.searchs=n,i.$apply()},50)},go:function(t){(0,_util.openTownApp)("pages/index/index?localId="+t.id)},init:function(){this.getCityData("1",0),this.getTownList()}},a=i,_possibleConstructorReturn(n,a)}return _inherits(e,t),_createClass(e,[{key:"reset",value:function(t){for(var i=t;i<4;i++){var n=this.citys[i];n.name="",n.value="",n.index=0,e.list[i]=[]}}},{key:"getCityData",value:function(t,i){var n=this,a=t||"";if(e.dataCache[a])return void this.updateCityData(i,e.dataCache[a]);(0,_util.request)("https://activity.58.com/wxa/town/listbylevel?provinceId="+a).then(function(t){if(0===t.code){var s=t.data.list;e.dataCache[a]=s,n.updateCityData(i,s),n.$apply()}})}},{key:"updateCityData",value:function(t,i){this.reset(t),this.level=t,this.hideList=!1,e.list[t]=i}},{key:"getTownList",value:function(){e.towlist.length||(0,_util.request)("https://activity.58.com/wxa/town/townlist").then(function(t){0===t.code&&(e.towlist=t.data.list)})}}]),e}(_wepy2.default.component);TownCityList.dataCache={},TownCityList.towlist=[],TownCityList.list=[[],[],[],[]],TownCityList.searchTimeoutId="",exports.default=TownCityList;